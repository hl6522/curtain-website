<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†…å®¹ç®¡ç† - Elegant Curtains</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
        }

        .header-main {
            text-align: center;
            margin-bottom: 25px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.4em;
            margin-bottom: 12px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #2c3e50, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 18px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            color: white;
            box-shadow: 0 3px 12px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .stat-card h3 {
            font-size: 0.9em;
            margin-bottom: 8px;
            opacity: 0.9;
            font-weight: 500;
        }

        .stat-number {
            font-size: 1.6em;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .stat-limit {
            font-size: 0.7em;
            opacity: 0.8;
            margin-bottom: 0;
        }

        .stat-remaining {
            display: none;
        }

        .actions-row {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 22px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 3px 12px rgba(52, 152, 219, 0.3);
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .action-btn.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .action-btn.info {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .content-sections {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-bottom: 30px;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .section h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .add-button {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .add-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .add-button:active {
            transform: translateY(0);
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .content-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            position: relative;
        }

        .content-item:hover {
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .content-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .content-item h3 {
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .content-item p {
            color: #7f8c8d;
            font-size: 0.9em;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .btn-edit, .btn-delete {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #3498db;
            color: white;
        }

        .btn-edit:hover {
            background: #2980b9;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-delete:hover {
            background: #c0392b;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .modal-header h3 {
            color: #2c3e50;
            font-size: 1.5em;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #e74c3c;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .file-upload {
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload-text {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .file-selected {
            color: #27ae60;
            font-weight: bold;
        }
        
        .file-info {
            margin-top: 8px;
            font-size: 0.9em;
            color: #6c757d;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .btn-save, .btn-cancel {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-save {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-cancel {
            background: #95a5a6;
            color: white;
        }

        .btn-cancel:hover {
            background: #7f8c8d;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .empty-state i {
            font-size: 3em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #95a5a6;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .language-switcher button {
            background: none;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 0 2px;
        }

        .language-switcher button.active {
            background: #3498db;
            color: white;
        }

        .language-switcher button:hover:not(.active) {
            background: #ecf0f1;
        }

        /* ä¸»ç•Œé¢æ ·å¼ */

        .login-info p {
            margin: 5px 0;
            color: #7f8c8d;
            font-size: 14px;
        }

        /* ä¸»ç•Œé¢æ ·å¼ */
        .main-section {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .top-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand h2 {
            color: #2c3e50;
            margin: 0;
            font-size: 1.8em;
        }

        .nav-brand span {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .nav-menu {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
            border: 2px solid #3498db;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
        }

        /* å…³äºæˆ‘ä»¬å†…å®¹æ ·å¼ */
        .about-us-content {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }

        .about-us-preview {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .about-us-text {
            flex: 1;
        }

        .about-us-text h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .about-us-text p {
            color: #7f8c8d;
            line-height: 1.6;
        }

        .about-us-image {
            flex-shrink: 0;
        }

        .about-us-image img {
            width: 200px;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        /* ä¸Šä¼ ä¿¡æ¯æ ·å¼ */
        .upload-info {
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
            border-left: 3px solid #2196f3;
        }

        .upload-info p {
            margin: 0 0 5px 0;
            color: #1976d2;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .upload-info p:last-child {
            margin-bottom: 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .storage-info {
                flex-direction: column;
                gap: 15px;
            }

            .storage-item {
                min-width: 120px;
                padding: 10px 20px;
            }

            .nav-container {
                flex-direction: column;
                gap: 15px;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }

            .about-us-preview {
                flex-direction: column;
            }

            .about-us-image img {
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <!-- ä¸»ç•Œé¢ -->
    <div id="mainSection" class="main-section">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <nav class="top-nav">
            <div class="nav-container">
                <div class="nav-brand">
                    <h2>Elegant Curtains</h2>
                    <span>å†…å®¹ç®¡ç†ç³»ç»Ÿ</span>
                </div>
                <div class="nav-menu">
                    <button class="nav-btn" onclick="goToHomepage()">
                        <span data-en="Homepage" data-zh="é¦–é¡µ">é¦–é¡µ</span>
                    </button>
                    <button class="nav-btn" onclick="goToAdmin()">
                        <span data-en="Admin Panel" data-zh="ç®¡ç†åå°">ç®¡ç†åå°</span>
                    </button>
                    <button class="nav-btn" onclick="logout()">
                        <span data-en="Logout" data-zh="é€€å‡ºç™»å½•">é€€å‡ºç™»å½•</span>
                    </button>
                </div>
            </div>
        </nav>

        <div class="language-switcher">
            <button class="active" onclick="switchLanguage('en')">EN</button>
            <button onclick="switchLanguage('zh')">ä¸­æ–‡</button>
        </div>

        <div class="container">
            <div class="header">
                <div class="header-main">
                    <h1>Elegant Curtains</h1>
                    <p>å†…å®¹ç®¡ç†ç³»ç»Ÿ</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 data-en="Product Series" data-zh="äº§å“ç³»åˆ—">Product Series</h3>
                        <div class="stat-number" id="productSeriesCount">0</div>
                        <div class="stat-limit">/ 10</div>
                        <div class="stat-remaining" id="productSeriesRemaining">å‰©ä½™: 10</div>
                    </div>
                    
                    <div class="stat-card">
                        <h3 data-en="Gallery Items" data-zh="ç”»å»Šé¡¹ç›®">Gallery Items</h3>
                        <div class="stat-number" id="galleryCount">0</div>
                        <div class="stat-limit">/ 15</div>
                        <div class="stat-remaining" id="galleryRemaining">å‰©ä½™: 15</div>
                    </div>
                    
                    <div class="stat-card">
                        <h3 data-en="Background Images" data-zh="èƒŒæ™¯å›¾ç‰‡">Background Images</h3>
                        <div class="stat-number" id="backgroundCount">0</div>
                        <div class="stat-limit">/ 8</div>
                        <div class="stat-remaining" id="backgroundRemaining">å‰©ä½™: 8</div>
                    </div>
                </div>
                
                <div class="actions-row">
                    <button class="action-btn danger" onclick="clearAllStorage()" data-en="Clear All" data-zh="æ¸…ç©ºæ‰€æœ‰">Clear All</button>
                    <button class="action-btn" onclick="optimizeStorage()" data-en="Optimize" data-zh="ä¼˜åŒ–">Optimize</button>
                    <button class="action-btn info" onclick="showStorageManagement()" data-en="Storage Info" data-zh="å­˜å‚¨ä¿¡æ¯">Storage Info</button>
                    <button class="action-btn secondary" onclick="showImageOptimizationTips()" data-en="Help" data-zh="å¸®åŠ©">Help</button>
                </div>
            </div>

        <div class="content-sections">
            <!-- äº§å“ç³»åˆ—ç®¡ç† -->
            <div class="section">
                <h2>
                    <span data-en="Product Series Management" data-zh="äº§å“ç³»åˆ—ç®¡ç†">Product Series Management</span>
                    <button class="add-button" onclick="openProductSeriesModal()">
                        <span data-en="Add New" data-zh="æ–°å¢">Add New</span>
                    </button>
                </h2>
                <div id="productSeriesGrid" class="content-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p data-en="Loading..." data-zh="åŠ è½½ä¸­...">Loading...</p>
                    </div>
                </div>
            </div>

            <!-- ç”»å»Šç®¡ç† -->
            <div class="section">
                <h2>
                    <span data-en="Gallery Management" data-zh="ç”»å»Šç®¡ç†">Gallery Management</span>
                    <button class="add-button" onclick="openGalleryModal()">
                        <span data-en="Add New" data-zh="æ–°å¢">Add New</span>
                    </button>
                </h2>
                <div id="galleryGrid" class="content-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p data-en="Loading..." data-zh="åŠ è½½ä¸­...">Loading...</p>
                    </div>
                </div>
            </div>

            <!-- é¦–é¡µèƒŒæ™¯å›¾ç‰‡ -->
            <div class="section">
                <h2>
                    <span data-en="Homepage Background Images" data-zh="é¦–é¡µèƒŒæ™¯å›¾ç‰‡">Homepage Background Images</span>
                    <button class="add-button" onclick="openBackgroundModal()">
                        <span data-en="Add New" data-zh="æ–°å¢">Add New</span>
                    </button>
                </h2>
                <div id="backgroundSlideshow" class="content-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p data-en="Loading..." data-zh="åŠ è½½ä¸­...">Loading...</p>
                    </div>
                </div>
            </div>

            <!-- å…³äºæˆ‘ä»¬ç®¡ç† -->
            <div class="section">
                <h2>
                    <span data-en="About Us Management" data-zh="å…³äºæˆ‘ä»¬ç®¡ç†">About Us Management</span>
                    <button class="add-button" onclick="openAboutUsModal()">
                        <span data-en="Edit" data-zh="ç¼–è¾‘">Edit</span>
                    </button>
                </h2>
                <div id="aboutUsContent" class="about-us-content">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p data-en="Loading..." data-zh="åŠ è½½ä¸­...">Loading...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- äº§å“ç³»åˆ—æ¨¡æ€æ¡† -->
    <div id="productSeriesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productSeriesModalTitle" data-en="Add New Product Series" data-zh="æ–°å¢äº§å“ç³»åˆ—">Add New Product Series</h3>
                <span class="close" onclick="closeProductSeriesModal()">&times;</span>
            </div>
            <form id="productSeriesForm" onsubmit="saveProductSeries(event)">
                <div class="form-group">
                    <label for="seriesName" data-en="Series Name" data-zh="ç³»åˆ—åç§°">Series Name</label>
                    <input type="text" id="seriesName" required>
                </div>
                <div class="form-group">
                    <label for="seriesDescription" data-en="Description" data-zh="æè¿°">Description</label>
                    <textarea id="seriesDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label for="seriesImage" data-en="Series Image" data-zh="ç³»åˆ—å›¾ç‰‡">Series Image</label>
                    <div class="file-upload" onclick="document.getElementById('seriesImage').click()">
                        <input type="file" id="seriesImage" accept="image/*" required onchange="updateFileName(this, 'seriesFileInfo')">
                        <div class="file-upload-text" data-en="Click to select image" data-zh="ç‚¹å‡»é€‰æ‹©å›¾ç‰‡">Click to select image</div>
                    </div>
                    <div id="seriesFileInfo" class="file-info" style="display: none;"></div>
                    <div class="upload-info">
                        <p data-en="Image size limit: Maximum 2MB, Recommended: 400x300 or higher" data-zh="å›¾ç‰‡å¤§å°é™åˆ¶ï¼šæœ€å¤§2MBï¼Œå»ºè®®å°ºå¯¸ï¼š400x300æˆ–æ›´é«˜">Image size limit: Maximum 2MB, Recommended: 400x300 or higher</p>
                        <p data-en="Maximum uploads: 10 images" data-zh="æœ€å¤§ä¸Šä¼ æ•°é‡ï¼š10å¼ å›¾ç‰‡">Maximum uploads: 10 images</p>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeProductSeriesModal()" data-en="Cancel" data-zh="å–æ¶ˆ">Cancel</button>
                    <button type="submit" class="btn-save" data-en="Save" data-zh="ä¿å­˜">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç”»å»Šæ¨¡æ€æ¡† -->
    <div id="galleryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="galleryModalTitle" data-en="Add New Gallery Item" data-zh="æ–°å¢ç”»å»Šé¡¹ç›®">Add New Gallery Item</h3>
                <span class="close" onclick="closeGalleryModal()">&times;</span>
            </div>
            <form id="galleryForm" onsubmit="saveGalleryItem(event)">
                <div class="form-group">
                    <label for="galleryTitle" data-en="Title" data-zh="æ ‡é¢˜">Title</label>
                    <input type="text" id="galleryTitle" required>
                </div>
                <div class="form-group">
                    <label for="galleryDescription" data-en="Description" data-zh="æè¿°">Description</label>
                    <textarea id="galleryDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label for="galleryImage" data-en="Gallery Image" data-zh="ç”»å»Šå›¾ç‰‡">Gallery Image</label>
                    <div class="file-upload" onclick="document.getElementById('galleryImage').click()">
                        <input type="file" id="galleryImage" accept="image/*" required onchange="updateFileName(this, 'galleryFileInfo')">
                        <div class="file-upload-text" data-en="Click to select image" data-zh="ç‚¹å‡»é€‰æ‹©å›¾ç‰‡">Click to select image</div>
                    </div>
                    <div id="galleryFileInfo" class="file-info" style="display: none;"></div>
                    <div class="upload-info">
                        <p data-en="Image size limit: Maximum 3MB, Recommended: 800x600 or higher" data-zh="å›¾ç‰‡å¤§å°é™åˆ¶ï¼šæœ€å¤§3MBï¼Œå»ºè®®å°ºå¯¸ï¼š800x600æˆ–æ›´é«˜">Image size limit: Maximum 3MB, Recommended: 800x600 or higher</p>
                        <p data-en="Maximum uploads: 15 images" data-zh="æœ€å¤§ä¸Šä¼ æ•°é‡ï¼š15å¼ å›¾ç‰‡">Maximum uploads: 15 images</p>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeGalleryModal()" data-en="Cancel" data-zh="å–æ¶ˆ">Cancel</button>
                    <button type="submit" class="btn-save" data-en="Save" data-zh="ä¿å­˜">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- èƒŒæ™¯å›¾ç‰‡æ¨¡æ€æ¡† -->
    <div id="backgroundModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="backgroundModalTitle" data-en="Add New Background Image" data-zh="æ–°å¢èƒŒæ™¯å›¾ç‰‡">Add New Background Image</h3>
                <span class="close" onclick="closeBackgroundModal()">&times;</span>
            </div>
            <form id="backgroundForm" onsubmit="saveBackgroundImage(event)">
                <div class="form-group">
                    <label for="backgroundImage" data-en="Background Image" data-zh="èƒŒæ™¯å›¾ç‰‡">Background Image</label>
                    <div class="file-upload" onclick="document.getElementById('backgroundImage').click()">
                        <input type="file" id="backgroundImage" accept="image/*" required onchange="updateFileName(this, 'backgroundFileInfo')">
                        <div class="file-upload-text" data-en="Click to select image" data-zh="ç‚¹å‡»é€‰æ‹©å›¾ç‰‡">Click to select image</div>
                    </div>
                    <div id="backgroundFileInfo" class="file-info" style="display: none;"></div>
                    <div class="upload-info">
                        <p data-en="Image size limit: Maximum 10MB, Recommended: 1920x1080 or higher" data-zh="å›¾ç‰‡å¤§å°é™åˆ¶ï¼šæœ€å¤§10MBï¼Œå»ºè®®å°ºå¯¸ï¼š1920x1080æˆ–æ›´é«˜">Image size limit: Maximum 10MB, Recommended: 1920x1080 or higher</p>
                        <p data-en="Maximum uploads: 8 images" data-zh="æœ€å¤§ä¸Šä¼ æ•°é‡ï¼š8å¼ å›¾ç‰‡">Maximum uploads: 8 images</p>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeBackgroundModal()" data-en="Cancel" data-zh="å–æ¶ˆ">Cancel</button>
                    <button type="submit" class="btn-save" data-en="Save" data-zh="ä¿å­˜">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å…³äºæˆ‘ä»¬æ¨¡æ€æ¡† -->
    <div id="aboutUsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="aboutUsModalTitle" data-en="Edit About Us" data-zh="ç¼–è¾‘å…³äºæˆ‘ä»¬">Edit About Us</h3>
                <span class="close" onclick="closeAboutUsModal()">&times;</span>
            </div>
            <form id="aboutUsForm" onsubmit="saveAboutUs(event)">
                <div class="form-group">
                    <label for="aboutUsTitle" data-en="Title" data-zh="æ ‡é¢˜">Title</label>
                    <input type="text" id="aboutUsTitle" required>
                </div>
                <div class="form-group">
                    <label for="aboutUsDescription" data-en="Description" data-zh="æè¿°">Description</label>
                    <textarea id="aboutUsDescription" required rows="4" placeholder="Enter a concise description about your company..."></textarea>
                </div>
                <div class="form-group">
                    <label for="aboutUsImage" data-en="About Us Image" data-zh="å…³äºæˆ‘ä»¬å›¾ç‰‡">About Us Image</label>
                    <div class="file-upload" onclick="document.getElementById('aboutUsImage').click()">
                        <input type="file" id="aboutUsImage" accept="image/*" onchange="updateFileName(this, 'aboutUsFileInfo')">
                        <div class="file-upload-text" data-en="Click to select image (Optional)" data-zh="ç‚¹å‡»é€‰æ‹©å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰">Click to select image (Optional)</div>
                    </div>
                    <div id="aboutUsFileInfo" class="file-info" style="display: none;"></div>
                    <div class="upload-info">
                        <p data-en="Image size limit: Maximum 3MB, Recommended: 800x600 or higher" data-zh="å›¾ç‰‡å¤§å°é™åˆ¶ï¼šæœ€å¤§3MBï¼Œå»ºè®®å°ºå¯¸ï¼š800x600æˆ–æ›´é«˜">Image size limit: Maximum 3MB, Recommended: 800x600 or higher</p>
                        <p data-en="Maximum uploads: 1 image" data-zh="æœ€å¤§ä¸Šä¼ æ•°é‡ï¼š1å¼ å›¾ç‰‡">Maximum uploads: 1 image</p>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeAboutUsModal()" data-en="Cancel" data-zh="å–æ¶ˆ">Cancel</button>
                    <button type="submit" class="btn-save" data-en="Save" data-zh="ä¿å­˜">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentLanguage = 'en';
        let editIndex = null;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œæ£€æŸ¥ç™»å½•çŠ¶æ€...');
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            checkLoginStatus();
            
            // åˆå§‹åŒ–é¡µé¢
            initializePage();
        });

        // è·³è½¬åˆ°é¦–é¡µ
        function goToHomepage() {
            window.open('index.html', '_blank');
        }

        // è·³è½¬åˆ°ç®¡ç†åå°
        function goToAdmin() {
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•ä¸ºç®¡ç†å‘˜
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                try {
                    const userInfo = JSON.parse(currentUser);
                    if (userInfo.userType === 'admin') {
                        // å·²ç™»å½•ä¸ºç®¡ç†å‘˜ï¼Œç›´æ¥è·³è½¬
                        window.open('admin.html', '_blank');
                        return;
                    }
                } catch (e) {
                    // è§£æå¤±è´¥ï¼Œæ¸…é™¤æ— æ•ˆæ•°æ®
                    localStorage.removeItem('currentUser');
                }
            }
            
            // æœªç™»å½•æˆ–ä¸æ˜¯ç®¡ç†å‘˜ï¼Œè·³è½¬åˆ°ç®¡ç†å‘˜ç™»å½•é¡µé¢
            window.open('admin-login.html', '_blank');
        }

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            console.log('åˆå§‹åŒ–é¡µé¢...');
            
            // åŠ è½½é»˜è®¤æ•°æ®ï¼ˆå¦‚æœlocalStorageä¸ºç©ºï¼‰
            loadDefaultData();
            
            // åŠ è½½å†…å®¹
            loadAllContent();
            
            // è®¾ç½®è¯­è¨€
            updateLanguageDisplay();
            
            // æ£€æŸ¥å¹¶æ¸…ç†å­˜å‚¨ç©ºé—´
            checkAndCleanupStorage();
            
            console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        }



        // åŠ è½½é»˜è®¤æ•°æ®
        function loadDefaultData() {
            console.log('æ£€æŸ¥å¹¶åŠ è½½é»˜è®¤æ•°æ®...');
            
            // äº§å“ç³»åˆ—
            if (!localStorage.getItem('productSeries')) {
                const defaultSeries = [
                    {
                        name: 'Classic Elegance',
                        description: 'Timeless designs for traditional homes',
                        image: getDefaultProductImage()
                    },
                    {
                        name: 'Modern Minimalist',
                        description: 'Clean lines for contemporary spaces',
                        image: getDefaultProductImage()
                    },
                    {
                        name: 'Luxury Collection',
                        description: 'Premium materials for sophisticated tastes',
                        image: getDefaultProductImage()
                    }
                ];
                localStorage.setItem('productSeries', JSON.stringify(defaultSeries));
                console.log('å·²åŠ è½½é»˜è®¤äº§å“ç³»åˆ—æ•°æ®');
            }
            
            // ç”»å»Š
            if (!localStorage.getItem('gallery')) {
                const defaultGallery = [
                    {
                        title: 'Elegant Living Room',
                        description: 'Beautiful curtains enhancing living space',
                        image: getDefaultGalleryImage()
                    },
                    {
                        title: 'Master Bedroom',
                        description: 'Serene bedroom with perfect curtains',
                        image: getDefaultGalleryImage()
                    }
                ];
                localStorage.setItem('gallery', JSON.stringify(defaultGallery));
                console.log('å·²åŠ è½½é»˜è®¤ç”»å»Šæ•°æ®');
            }
            
            // èƒŒæ™¯å›¾ç‰‡
            if (!localStorage.getItem('backgroundImages')) {
                const defaultBackgrounds = [
                    {
                        image: getDefaultBackgroundImage()
                    },
                    {
                        image: getDefaultBackgroundImage()
                    }
                ];
                localStorage.setItem('backgroundImages', JSON.stringify(defaultBackgrounds));
                console.log('å·²åŠ è½½é»˜è®¤èƒŒæ™¯å›¾ç‰‡æ•°æ®');
            }
        }

        // åŠ è½½æ‰€æœ‰å†…å®¹
        function loadAllContent() {
            console.log('å¼€å§‹åŠ è½½æ‰€æœ‰å†…å®¹...');
            
            // åŠ è½½äº§å“ç³»åˆ—
            loadProductSeries();
            
            // åŠ è½½ç”»å»Š
            loadGallery();
            
            // åŠ è½½èƒŒæ™¯å›¾ç‰‡
            loadBackgroundImages();
            
            // åŠ è½½å…³äºæˆ‘ä»¬
            loadAboutUs();
            
            // æ›´æ–°å­˜å‚¨è®¡æ•°
            updateStorageCounts();
            
            console.log('æ‰€æœ‰å†…å®¹åŠ è½½å®Œæˆ');
        }

        // åŠ è½½äº§å“ç³»åˆ—
        function loadProductSeries() {
            console.log('åŠ è½½äº§å“ç³»åˆ—...');
            const grid = document.getElementById('productSeriesGrid');
            const series = JSON.parse(localStorage.getItem('productSeries') || '[]');
            
            if (series.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <i>ğŸ“¦</i>
                        <h3 data-en="No Product Series" data-zh="æš‚æ— äº§å“ç³»åˆ—">No Product Series</h3>
                        <p data-en="Add your first product series to get started" data-zh="æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªäº§å“ç³»åˆ—å¼€å§‹ä½¿ç”¨">Add your first product series to get started</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = series.map((item, index) => `
                <div class="content-item">
                    <img src="${item.image}" alt="${item.name}" onerror="this.src='${getDefaultProductImage()}'">
                    <h3>${item.name}</h3>
                    <p>${item.description}</p>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editProductSeries(${index})" data-en="Edit" data-zh="ç¼–è¾‘">Edit</button>
                        <button class="btn-delete" onclick="deleteProductSeries(${index})" data-en="Delete" data-zh="åˆ é™¤">Delete</button>
                    </div>
                </div>
            `).join('');
            
            updateLanguageDisplay();
        }

        // åŠ è½½ç”»å»Š
        function loadGallery() {
            console.log('åŠ è½½ç”»å»Š...');
            const grid = document.getElementById('galleryGrid');
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            
            if (gallery.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <i>ğŸ–¼ï¸</i>
                        <h3 data-en="No Gallery Items" data-zh="æš‚æ— ç”»å»Šé¡¹ç›®">No Gallery Items</h3>
                        <p data-en="Add your first gallery item to showcase your work" data-zh="æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªç”»å»Šé¡¹ç›®å±•ç¤ºä½œå“">Add your first gallery item to showcase your work</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = gallery.map((item, index) => `
                <div class="content-item">
                    <img src="${item.image}" alt="${item.title}" onerror="this.src='${getDefaultGalleryImage()}'">
                    <h3>${item.title}</h3>
                    <p>${item.description}</p>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editGalleryItem(${index})" data-en="Edit" data-zh="ç¼–è¾‘">Edit</button>
                        <button class="btn-delete" onclick="deleteGalleryItem(${index})" data-en="Delete" data-zh="åˆ é™¤">Delete</button>
                    </div>
                </div>
            `).join('');
            
            updateLanguageDisplay();
        }

        // åŠ è½½èƒŒæ™¯å›¾ç‰‡
        function loadBackgroundImages() {
            console.log('åŠ è½½èƒŒæ™¯å›¾ç‰‡...');
            const slideshow = document.getElementById('backgroundSlideshow');
            const backgrounds = JSON.parse(localStorage.getItem('backgroundImages') || '[]');
            
            if (backgrounds.length === 0) {
                slideshow.innerHTML = `
                    <div class="empty-state">
                        <i>ğŸ </i>
                        <h3 data-en="No Background Images" data-zh="æš‚æ— èƒŒæ™¯å›¾ç‰‡">No Background Images</h3>
                        <p data-en="Add background images for your homepage" data-zh="ä¸ºæ‚¨çš„é¦–é¡µæ·»åŠ èƒŒæ™¯å›¾ç‰‡">Add background images for your homepage</p>
                    </div>
                `;
                return;
            }
            
            slideshow.innerHTML = backgrounds.map((item, index) => `
                <div class="content-item">
                    <img src="${item.image}" alt="Background ${index + 1}" onerror="this.src='${getDefaultBackgroundImage()}'">
                    <h3 data-en="Background Image" data-zh="èƒŒæ™¯å›¾ç‰‡">Background Image ${index + 1}</h3>
                    <p data-en="Homepage background image" data-zh="é¦–é¡µèƒŒæ™¯å›¾ç‰‡">Homepage background image</p>
                    <div class="item-actions">
                        <button class="btn-delete" onclick="deleteBackgroundImage(${index})" data-en="Delete" data-zh="åˆ é™¤">Delete</button>
                    </div>
                </div>
            `).join('');
            
            updateLanguageDisplay();
        }

        // åŠ è½½å…³äºæˆ‘ä»¬å†…å®¹
        function loadAboutUs() {
            console.log('åŠ è½½å…³äºæˆ‘ä»¬å†…å®¹...');
            const container = document.getElementById('aboutUsContent');
            const aboutUs = JSON.parse(localStorage.getItem('aboutUs') || '{}');
            
            if (!aboutUs.title && !aboutUs.description) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i>â„¹ï¸</i>
                        <h3 data-en="No About Us Content" data-zh="æš‚æ— å…³äºæˆ‘ä»¬å†…å®¹">No About Us Content</h3>
                        <p data-en="Click Edit to add about us information" data-zh="ç‚¹å‡»ç¼–è¾‘æ·»åŠ å…³äºæˆ‘ä»¬ä¿¡æ¯">Click Edit to add about us information</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="about-us-preview">
                    <div class="about-us-text">
                        <h3>${aboutUs.title || 'å…³äºæˆ‘ä»¬'}</h3>
                        <p>${aboutUs.description || 'æš‚æ— æè¿°'}</p>
                    </div>
                    ${aboutUs.image ? `
                        <div class="about-us-image">
                            <img src="${aboutUs.image}" alt="About Us" onerror="this.src='${getDefaultAboutImage()}'">
                        </div>
                    ` : ''}
                </div>
            `;
            
            updateLanguageDisplay();
        }

        // æ¨¡æ€æ¡†å‡½æ•°
        function openProductSeriesModal(index = null) {
            console.log('æ‰“å¼€äº§å“ç³»åˆ—æ¨¡æ€æ¡†', index);
            editIndex = index;
            const modal = document.getElementById('productSeriesModal');
            const title = document.getElementById('productSeriesModalTitle');
            const form = document.getElementById('productSeriesForm');
            
            if (index !== null) {
                // ç¼–è¾‘æ¨¡å¼
                const series = JSON.parse(localStorage.getItem('productSeries') || '[]');
                const item = series[index];
                if (item) {
                    title.textContent = currentLanguage === 'en' ? 'Edit Product Series' : 'ç¼–è¾‘äº§å“ç³»åˆ—';
                    document.getElementById('seriesName').value = item.name;
                    document.getElementById('seriesDescription').value = item.description;
                }
            } else {
                // æ–°å¢æ¨¡å¼
                title.textContent = currentLanguage === 'en' ? 'Add New Product Series' : 'æ–°å¢äº§å“ç³»åˆ—';
                form.reset();
            }
            
            // é‡ç½®æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
            const fileInfo = document.getElementById('seriesFileInfo');
            if (fileInfo) {
                fileInfo.style.display = 'none';
            }
            
            // é‡ç½®æ–‡ä»¶ä¸Šä¼ æ–‡æœ¬
            const uploadText = modal.querySelector('.file-upload-text');
            if (uploadText) {
                uploadText.textContent = currentLanguage === 'en' ? 'Click to select image' : 'ç‚¹å‡»é€‰æ‹©å›¾ç‰‡';
                uploadText.classList.remove('file-selected');
            }
            
            modal.style.display = 'block';
        }

        function openGalleryModal(index = null) {
            console.log('æ‰“å¼€ç”»å»Šæ¨¡æ€æ¡†', index);
            editIndex = index;
            const modal = document.getElementById('galleryModal');
            const title = document.getElementById('galleryModalTitle');
            const form = document.getElementById('galleryForm');
            
            if (index !== null) {
                // ç¼–è¾‘æ¨¡å¼
                const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
                const item = gallery[index];
                if (item) {
                    title.textContent = currentLanguage === 'en' ? 'Edit Gallery Item' : 'ç¼–è¾‘ç”»å»Šé¡¹ç›®';
                    document.getElementById('galleryTitle').value = item.title;
                    document.getElementById('galleryDescription').value = item.description;
                }
            } else {
                // æ–°å¢æ¨¡å¼
                title.textContent = currentLanguage === 'en' ? 'Add New Gallery Item' : 'æ–°å¢ç”»å»Šé¡¹ç›®';
                form.reset();
            }
            
            // é‡ç½®æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
            const fileInfo = document.getElementById('galleryFileInfo');
            if (fileInfo) {
                fileInfo.style.display = 'none';
            }
            
            // é‡ç½®æ–‡ä»¶ä¸Šä¼ æ–‡æœ¬
            const uploadText = modal.querySelector('.file-upload-text');
            if (uploadText) {
                uploadText.textContent = currentLanguage === 'en' ? 'Click to select image' : 'ç‚¹å‡»é€‰æ‹©å›¾ç‰‡';
                uploadText.classList.remove('file-selected');
            }
            
            modal.style.display = 'block';
        }

        function openBackgroundModal(index = null) {
            console.log('æ‰“å¼€èƒŒæ™¯å›¾ç‰‡æ¨¡æ€æ¡†', index);
            editIndex = index;
            const modal = document.getElementById('backgroundModal');
            const title = document.getElementById('backgroundModalTitle');
            const form = document.getElementById('backgroundForm');
            
            if (index !== null) {
                // ç¼–è¾‘æ¨¡å¼
                title.textContent = currentLanguage === 'en' ? 'Edit Background Image' : 'ç¼–è¾‘èƒŒæ™¯å›¾ç‰‡';
            } else {
                // æ–°å¢æ¨¡å¼
                title.textContent = currentLanguage === 'en' ? 'Add New Background Image' : 'æ–°å¢èƒŒæ™¯å›¾ç‰‡';
                form.reset();
            }
            
            // é‡ç½®æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
            const fileInfo = document.getElementById('backgroundFileInfo');
            if (fileInfo) {
                fileInfo.style.display = 'none';
            }
            
            // é‡ç½®æ–‡ä»¶ä¸Šä¼ æ–‡æœ¬
            const uploadText = modal.querySelector('.file-upload-text');
            if (uploadText) {
                uploadText.textContent = currentLanguage === 'en' ? 'Click to select image' : 'ç‚¹å‡»é€‰æ‹©å›¾ç‰‡';
                uploadText.classList.remove('file-selected');
            }
            
            modal.style.display = 'block';
        }

        function openAboutUsModal() {
            console.log('æ‰“å¼€å…³äºæˆ‘ä»¬æ¨¡æ€æ¡†');
            const modal = document.getElementById('aboutUsModal');
            const form = document.getElementById('aboutUsForm');
            const aboutUs = JSON.parse(localStorage.getItem('aboutUs') || '{}');
            
            // å¡«å……ç°æœ‰æ•°æ®
            document.getElementById('aboutUsTitle').value = aboutUs.title || '';
            document.getElementById('aboutUsDescription').value = aboutUs.description || '';
            
            // é‡ç½®æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
            const fileInfo = document.getElementById('aboutUsFileInfo');
            if (fileInfo) {
                fileInfo.style.display = 'none';
            }
            
            // é‡ç½®æ–‡ä»¶ä¸Šä¼ æ–‡æœ¬
            const uploadText = document.querySelector('#aboutUsModal .file-upload-text');
            if (uploadText) {
                uploadText.textContent = currentLanguage === 'en' ? 'Click to select image (Optional)' : 'ç‚¹å‡»é€‰æ‹©å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰';
                uploadText.classList.remove('file-selected');
            }
            
            modal.style.display = 'block';
        }

        function closeProductSeriesModal() {
            document.getElementById('productSeriesModal').style.display = 'none';
            editIndex = null;
        }

        function closeGalleryModal() {
            document.getElementById('galleryModal').style.display = 'none';
            editIndex = null;
        }

        function closeBackgroundModal() {
            document.getElementById('backgroundModal').style.display = 'none';
            editIndex = null;
        }

        function closeAboutUsModal() {
            document.getElementById('aboutUsModal').style.display = 'none';
        }

        // ä¿å­˜å‡½æ•°
        async function saveProductSeries(event) {
            event.preventDefault();
            console.log('ä¿å­˜äº§å“ç³»åˆ—...');
            
            try {
                const name = document.getElementById('seriesName').value;
                const description = document.getElementById('seriesDescription').value;
                const imageFile = document.getElementById('seriesImage').files[0];
                
                if (!imageFile) {
                    alert(currentLanguage === 'en' ? 'Please select an image' : 'è¯·é€‰æ‹©å›¾ç‰‡');
                    return;
                }
                
                // æ£€æŸ¥å›¾ç‰‡æ•°é‡é™åˆ¶
                const series = JSON.parse(localStorage.getItem('productSeries') || '[]');
                if (editIndex === null && series.length >= 10) {
                    alert(currentLanguage === 'en' ? 'Maximum 10 product series allowed. Please delete some before adding new ones.' : 'æœ€å¤šå…è®¸10ä¸ªäº§å“ç³»åˆ—ã€‚è¯·åˆ é™¤ä¸€äº›åå†æ·»åŠ æ–°çš„ã€‚');
                    return;
                }
                
                const imageData = await processImageFile(imageFile);
                
                if (editIndex !== null) {
                    // ç¼–è¾‘æ¨¡å¼
                    series[editIndex] = { name, description, image: imageData };
                } else {
                    // æ–°å¢æ¨¡å¼
                    series.push({ name, description, image: imageData });
                }
                
                localStorage.setItem('productSeries', JSON.stringify(series));
                closeProductSeriesModal();
                loadProductSeries();
                updateStorageCounts();
                
                console.log('äº§å“ç³»åˆ—ä¿å­˜æˆåŠŸ');
            } catch (error) {
                console.error('ä¿å­˜äº§å“ç³»åˆ—å¤±è´¥:', error);
                if (error.name === 'QuotaExceededError') {
                    alert(currentLanguage === 'en' ? 'Storage space exceeded. Please delete some items first.' : 'å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚è¯·å…ˆåˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                } else {
                    alert(currentLanguage === 'en' ? 'Failed to save product series' : 'ä¿å­˜äº§å“ç³»åˆ—å¤±è´¥');
                }
            }
        }

        async function saveGalleryItem(event) {
            event.preventDefault();
            console.log('ä¿å­˜ç”»å»Šé¡¹ç›®...');
            
            try {
                const title = document.getElementById('galleryTitle').value;
                const description = document.getElementById('galleryDescription').value;
                const imageFile = document.getElementById('galleryImage').files[0];
                
                if (!imageFile) {
                    alert(currentLanguage === 'en' ? 'Please select an image' : 'è¯·é€‰æ‹©å›¾ç‰‡');
                    return;
                }
                
                // æ£€æŸ¥å›¾ç‰‡æ•°é‡é™åˆ¶
                const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
                if (editIndex === null && gallery.length >= 15) {
                    alert(currentLanguage === 'en' ? 'Maximum 15 gallery items allowed. Please delete some before adding new ones.' : 'æœ€å¤šå…è®¸15ä¸ªç”»å»Šé¡¹ç›®ã€‚è¯·åˆ é™¤ä¸€äº›åå†æ·»åŠ æ–°çš„ã€‚');
                    return;
                }
                
                // æ£€æŸ¥å­˜å‚¨ç©ºé—´
                if (!checkStorageQuota()) {
                    if (cleanupStorage()) {
                        if (!checkStorageQuota()) {
                            alert(currentLanguage === 'en' ? 'Storage space is full. Please delete some items first.' : 'å­˜å‚¨ç©ºé—´å·²æ»¡ã€‚è¯·å…ˆåˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                            return;
                        }
                    } else {
                        alert(currentLanguage === 'en' ? 'Storage space is full. Please delete some items first.' : 'å­˜å‚¨ç©ºé—´å·²æ»¡ã€‚è¯·å…ˆåˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                        return;
                    }
                }
                
                const imageData = await processImageFile(imageFile);
                
                if (editIndex !== null) {
                    // ç¼–è¾‘æ¨¡å¼
                    gallery[editIndex] = { title, description, image: imageData };
                } else {
                    // æ–°å¢æ¨¡å¼
                    gallery.push({ title, description, image: imageData });
                }
                
                try {
                    localStorage.setItem('gallery', JSON.stringify(gallery));
                    closeGalleryModal();
                    loadGallery();
                    updateStorageCounts();
                    console.log('ç”»å»Šé¡¹ç›®ä¿å­˜æˆåŠŸ');
                } catch (storageError) {
                    if (storageError.name === 'QuotaExceededError') {
                        if (cleanupStorage()) {
                            try {
                                localStorage.setItem('gallery', JSON.stringify(gallery));
                                closeGalleryModal();
                                loadGallery();
                                updateStorageCounts();
                                console.log('ç”»å»Šé¡¹ç›®ä¿å­˜æˆåŠŸï¼ˆæ¸…ç†åï¼‰');
                            } catch (retryError) {
                                alert(currentLanguage === 'en' ? 'Storage space still insufficient. Please delete more items.' : 'å­˜å‚¨ç©ºé—´ä»ç„¶ä¸è¶³ã€‚è¯·åˆ é™¤æ›´å¤šé¡¹ç›®ã€‚');
                                throw retryError;
                            }
                        } else {
                            alert(currentLanguage === 'en' ? 'Storage space insufficient. Please delete some items.' : 'å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚è¯·åˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                            throw storageError;
                        }
                    } else {
                        throw storageError;
                    }
                }
            } catch (error) {
                console.error('ä¿å­˜ç”»å»Šé¡¹ç›®å¤±è´¥:', error);
                if (error.name === 'QuotaExceededError') {
                    alert(currentLanguage === 'en' ? 'Storage space exceeded. Please delete some items first.' : 'å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚è¯·å…ˆåˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                } else if (error.message === 'File too large' || error.message === 'Compressed image too large') {
                    return; // é”™è¯¯å·²åœ¨processImageFileä¸­å¤„ç†
                } else {
                    alert(currentLanguage === 'en' ? 'Failed to save gallery item' : 'ä¿å­˜ç”»å»Šé¡¹ç›®å¤±è´¥');
                }
            }
        }

        async function saveBackgroundImage(event) {
            event.preventDefault();
            console.log('ä¿å­˜èƒŒæ™¯å›¾ç‰‡...');
            
            try {
                const imageFile = document.getElementById('backgroundImage').files[0];
                
                if (!imageFile) {
                    alert(currentLanguage === 'en' ? 'Please select an image' : 'è¯·é€‰æ‹©å›¾ç‰‡');
                    return;
                }
                
                // æ£€æŸ¥å›¾ç‰‡æ•°é‡é™åˆ¶
                const backgrounds = JSON.parse(localStorage.getItem('backgroundImages') || '[]');
                if (editIndex === null && backgrounds.length >= 8) {
                    alert(currentLanguage === 'en' ? 'Maximum 8 background images allowed. Please delete some before adding new ones.' : 'æœ€å¤šå…è®¸8å¼ èƒŒæ™¯å›¾ç‰‡ã€‚è¯·åˆ é™¤ä¸€äº›åå†æ·»åŠ æ–°çš„ã€‚');
                    return;
                }
                
                // æ£€æŸ¥å­˜å‚¨ç©ºé—´
                if (!checkStorageQuota()) {
                    // å°è¯•æ¸…ç†å­˜å‚¨ç©ºé—´
                    if (cleanupStorage()) {
                        if (!checkStorageQuota()) {
                            alert(currentLanguage === 'en' ? 'Storage space is full. Please delete some items first.' : 'å­˜å‚¨ç©ºé—´å·²æ»¡ã€‚è¯·å…ˆåˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                            return;
                        }
                    } else {
                        alert(currentLanguage === 'en' ? 'Storage space is full. Please delete some items first.' : 'å­˜å‚¨ç©ºé—´å·²æ»¡ã€‚è¯·å…ˆåˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                        return;
                    }
                }
                
                const imageData = await processImageFile(imageFile);
                
                if (editIndex !== null) {
                    // ç¼–è¾‘æ¨¡å¼
                    backgrounds[editIndex] = { image: imageData };
                } else {
                    // æ–°å¢æ¨¡å¼
                    backgrounds.push({ image: imageData });
                }
                
                try {
                    localStorage.setItem('backgroundImages', JSON.stringify(backgrounds));
                    closeBackgroundModal();
                    loadBackgroundImages();
                    updateStorageCounts();
                    console.log('èƒŒæ™¯å›¾ç‰‡ä¿å­˜æˆåŠŸ');
                } catch (storageError) {
                    if (storageError.name === 'QuotaExceededError') {
                        // å¦‚æœä»ç„¶è¶…å‡ºé…é¢ï¼Œå°è¯•æ¸…ç†åé‡è¯•
                        if (cleanupStorage()) {
                            try {
                                localStorage.setItem('backgroundImages', JSON.stringify(backgrounds));
                                closeBackgroundModal();
                                loadBackgroundImages();
                                updateStorageCounts();
                                console.log('èƒŒæ™¯å›¾ç‰‡ä¿å­˜æˆåŠŸï¼ˆæ¸…ç†åï¼‰');
                            } catch (retryError) {
                                alert(currentLanguage === 'en' ? 'Storage space still insufficient. Please delete more items.' : 'å­˜å‚¨ç©ºé—´ä»ç„¶ä¸è¶³ã€‚è¯·åˆ é™¤æ›´å¤šé¡¹ç›®ã€‚');
                                throw retryError;
                            }
                        } else {
                            alert(currentLanguage === 'en' ? 'Storage space insufficient. Please delete some items.' : 'å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚è¯·åˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                            throw storageError;
                        }
                    } else {
                        throw storageError;
                    }
                }
            } catch (error) {
                console.error('ä¿å­˜èƒŒæ™¯å›¾ç‰‡å¤±è´¥:', error);
                if (error.name === 'QuotaExceededError') {
                    alert(currentLanguage === 'en' ? 'Storage space exceeded. Please delete some items first.' : 'å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚è¯·å…ˆåˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                } else if (error.message === 'File too large') {
                    // æ–‡ä»¶è¿‡å¤§é”™è¯¯å·²åœ¨processImageFileä¸­å¤„ç†
                    return;
                } else if (error.message === 'Compressed image too large') {
                    // å‹ç¼©åä»ç„¶è¿‡å¤§é”™è¯¯å·²åœ¨processImageFileä¸­å¤„ç†
                    return;
                } else {
                    alert(currentLanguage === 'en' ? 'Failed to save background image' : 'ä¿å­˜èƒŒæ™¯å›¾ç‰‡å¤±è´¥');
                }
            }
        }

        async function saveAboutUs(event) {
            event.preventDefault();
            console.log('ä¿å­˜å…³äºæˆ‘ä»¬å†…å®¹...');
            
            try {
                const title = document.getElementById('aboutUsTitle').value;
                const description = document.getElementById('aboutUsDescription').value;
                const imageFile = document.getElementById('aboutUsImage').files[0];
                
                let imageData = null;
                if (imageFile) {
                    // æ£€æŸ¥å­˜å‚¨ç©ºé—´
                    if (!checkStorageQuota()) {
                        if (cleanupStorage()) {
                            if (!checkStorageQuota()) {
                                alert(currentLanguage === 'en' ? 'Storage space is full. Please delete some items first.' : 'å­˜å‚¨ç©ºé—´å·²æ»¡ã€‚è¯·å…ˆåˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                                return;
                            }
                        } else {
                            alert(currentLanguage === 'en' ? 'Storage space is full. Please delete some items first.' : 'å­˜å‚¨ç©ºé—´å·²æ»¡ã€‚è¯·å…ˆåˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                            return;
                        }
                    }
                    
                    imageData = await processImageFile(imageFile);
                }
                
                const aboutUs = {
                    title: title,
                    description: description
                };
                
                if (imageData) {
                    aboutUs.image = imageData;
                }
                
                try {
                    localStorage.setItem('aboutUs', JSON.stringify(aboutUs));
                    closeAboutUsModal();
                    loadAboutUs();
                    updateStorageCounts();
                    console.log('å…³äºæˆ‘ä»¬å†…å®¹ä¿å­˜æˆåŠŸ');
                } catch (storageError) {
                    if (storageError.name === 'QuotaExceededError') {
                        if (cleanupStorage()) {
                            try {
                                localStorage.setItem('aboutUs', JSON.stringify(aboutUs));
                                closeAboutUsModal();
                                loadAboutUs();
                                updateStorageCounts();
                                console.log('å…³äºæˆ‘ä»¬å†…å®¹ä¿å­˜æˆåŠŸï¼ˆæ¸…ç†åï¼‰');
                            } catch (retryError) {
                                alert(currentLanguage === 'en' ? 'Storage space still insufficient. Please delete more items.' : 'å­˜å‚¨ç©ºé—´ä»ç„¶ä¸è¶³ã€‚è¯·åˆ é™¤æ›´å¤šé¡¹ç›®ã€‚');
                                throw retryError;
                            }
                        } else {
                            alert(currentLanguage === 'en' ? 'Storage space insufficient. Please delete some items.' : 'å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚è¯·åˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                            throw storageError;
                        }
                    } else {
                        throw storageError;
                    }
                }
            } catch (error) {
                console.error('ä¿å­˜å…³äºæˆ‘ä»¬å†…å®¹å¤±è´¥:', error);
                if (error.name === 'QuotaExceededError') {
                    alert(currentLanguage === 'en' ? 'Storage space exceeded. Please delete some items first.' : 'å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚è¯·å…ˆåˆ é™¤ä¸€äº›é¡¹ç›®ã€‚');
                } else if (error.message === 'File too large' || error.message === 'Compressed image too large') {
                    return; // é”™è¯¯å·²åœ¨processImageFileä¸­å¤„ç†
                } else {
                    alert(currentLanguage === 'en' ? 'Failed to save about us content' : 'ä¿å­˜å…³äºæˆ‘ä»¬å†…å®¹å¤±è´¥');
                }
            }
        }

        // åˆ é™¤å‡½æ•°
        function deleteProductSeries(index) {
            if (confirm(currentLanguage === 'en' ? 'Are you sure you want to delete this product series?' : 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªäº§å“ç³»åˆ—å—ï¼Ÿ')) {
                const series = JSON.parse(localStorage.getItem('productSeries') || '[]');
                series.splice(index, 1);
                localStorage.setItem('productSeries', JSON.stringify(series));
                loadProductSeries();
                updateStorageCounts();
                console.log('äº§å“ç³»åˆ—åˆ é™¤æˆåŠŸ');
            }
        }

        function deleteGalleryItem(index) {
            if (confirm(currentLanguage === 'en' ? 'Are you sure you want to delete this gallery item?' : 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”»å»Šé¡¹ç›®å—ï¼Ÿ')) {
                const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
                gallery.splice(index, 1);
                localStorage.setItem('gallery', JSON.stringify(gallery));
                loadGallery();
                updateStorageCounts();
                console.log('ç”»å»Šé¡¹ç›®åˆ é™¤æˆåŠŸ');
            }
        }

        function deleteBackgroundImage(index) {
            if (confirm(currentLanguage === 'en' ? 'Are you sure you want to delete this background image?' : 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªèƒŒæ™¯å›¾ç‰‡å—ï¼Ÿ')) {
                const backgrounds = JSON.parse(localStorage.getItem('backgroundImages') || '[]');
                backgrounds.splice(index, 1);
                localStorage.setItem('backgroundImages', JSON.stringify(backgrounds));
                loadBackgroundImages();
                updateStorageCounts();
                console.log('èƒŒæ™¯å›¾ç‰‡åˆ é™¤æˆåŠŸ');
            }
        }

        // ç¼–è¾‘å‡½æ•°
        function editProductSeries(index) {
            openProductSeriesModal(index);
        }

        function editGalleryItem(index) {
            openGalleryModal(index);
        }

        // å›¾ç‰‡å¤„ç†å‡½æ•° - å¢å¼ºç‰ˆï¼ŒåŒ…å«å‹ç¼©åŠŸèƒ½
        async function processImageFile(file) {
            return new Promise((resolve, reject) => {
                // æ£€æŸ¥æ–‡ä»¶å¤§å°
                if (file.size > 5 * 1024 * 1024) { // 5MBé™åˆ¶
                    alert(currentLanguage === 'en' ? 'Image file too large. Please select an image smaller than 5MB.' : 'å›¾ç‰‡æ–‡ä»¶è¿‡å¤§ã€‚è¯·é€‰æ‹©å°äº5MBçš„å›¾ç‰‡ã€‚');
                    reject(new Error('File too large'));
                    return;
                }

                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    // è®¡ç®—å‹ç¼©åçš„å°ºå¯¸ï¼Œä¿æŒå®½é«˜æ¯”
                    let { width, height } = img;
                    const maxWidth = 1200;
                    const maxHeight = 800;
                    
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width *= ratio;
                        height *= ratio;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // ç»˜åˆ¶å¹¶å‹ç¼©å›¾ç‰‡
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // å‹ç¼©ä¸ºJPEGæ ¼å¼ï¼Œè´¨é‡0.8
                    const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // æ£€æŸ¥å‹ç¼©åçš„å¤§å°
                    const compressedSize = Math.ceil(compressedDataUrl.length * 0.75); // base64å¤§çº¦æ¯”å®é™…å¤§å°å¤§33%
                    if (compressedSize > 2 * 1024 * 1024) { // 2MBé™åˆ¶
                        alert(currentLanguage === 'en' ? 'Image still too large after compression. Please try a smaller image.' : 'å›¾ç‰‡å‹ç¼©åä»ç„¶è¿‡å¤§ã€‚è¯·å°è¯•æ›´å°çš„å›¾ç‰‡ã€‚');
                        reject(new Error('Compressed image too large'));
                        return;
                    }
                    
                    resolve(compressedDataUrl);
                };
                
                img.onerror = reject;
                img.src = URL.createObjectURL(file);
            });
        }

        // æ£€æŸ¥å­˜å‚¨ç©ºé—´
        function checkStorageQuota() {
            try {
                const testKey = '__storage_test__';
                const testValue = '1';
                localStorage.setItem(testKey, testValue);
                localStorage.removeItem(testKey);
                return true;
            } catch (e) {
                return false;
            }
        }

        // è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µ
        function getStorageUsage() {
            let totalSize = 0;
            try {
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        totalSize += localStorage[key].length;
                    }
                }
                return totalSize;
            } catch (e) {
                return 0;
            }
        }

        // æ¸…ç†å­˜å‚¨ç©ºé—´
        function cleanupStorage() {
            try {
                const backgrounds = JSON.parse(localStorage.getItem('backgroundImages') || '[]');
                const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
                
                // å¦‚æœèƒŒæ™¯å›¾ç‰‡è¶…è¿‡4å¼ ï¼Œåˆ é™¤æœ€æ—§çš„
                if (backgrounds.length > 4) {
                    backgrounds.splice(0, backgrounds.length - 4);
                    localStorage.setItem('backgroundImages', JSON.stringify(backgrounds));
                }
                
                // å¦‚æœç”»å»Šé¡¹ç›®è¶…è¿‡10ä¸ªï¼Œåˆ é™¤æœ€æ—§çš„
                if (gallery.length > 10) {
                    gallery.splice(0, gallery.length - 10);
                    localStorage.setItem('gallery', JSON.stringify(gallery));
                }
                
                console.log('å­˜å‚¨ç©ºé—´æ¸…ç†å®Œæˆ');
                return true;
            } catch (e) {
                console.error('æ¸…ç†å­˜å‚¨ç©ºé—´å¤±è´¥:', e);
                return false;
            }
        }

        // é»˜è®¤å›¾ç‰‡å‡½æ•°
        function getDefaultProductImage() {
            const svg = `<svg width="200" height="150" xmlns="http://www.w3.org/2000/svg">
                <rect width="200" height="150" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2"/>
                <text x="100" y="75" font-family="Arial" font-size="14" fill="#6c757d" text-anchor="middle">Product Image</text>
            </svg>`;
            return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
        }

        function getDefaultGalleryImage() {
            const svg = `<svg width="200" height="150" xmlns="http://www.w3.org/2000/svg">
                <rect width="200" height="150" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
                <text x="100" y="75" font-family="Arial" font-size="14" fill="#1976d2" text-anchor="middle">Gallery Image</text>
            </svg>`;
            return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
        }

        function getDefaultBackgroundImage() {
            const svg = `<svg width="200" height="150" xmlns="http://www.w3.org/2000/svg">
                <rect width="200" height="150" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
                <text x="100" y="75" font-family="Arial" font-size="14" fill="#7b1fa2" text-anchor="middle">Background Image</text>
            </svg>`;
            return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
        }

        function getDefaultAboutImage() {
            const svg = `<svg width="200" height="150" xmlns="http://www.w3.org/2000/svg">
                <rect width="200" height="150" fill="#fff3e0" stroke="#ff9800" stroke-width="2"/>
                <text x="100" y="75" font-family="Arial" font-size="14" fill="#f57c00" text-anchor="middle">About Us Image</text>
            </svg>`;
            return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
        }

        // è¯­è¨€åˆ‡æ¢å‡½æ•°
        function switchLanguage(lang) {
            currentLanguage = lang;
            updateLanguageDisplay();
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.language-switcher button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function updateLanguageDisplay() {
            const elements = document.querySelectorAll('[data-en][data-zh]');
            elements.forEach(element => {
                if (currentLanguage === 'en') {
                    element.textContent = element.getAttribute('data-en');
                } else {
                    element.textContent = element.getAttribute('data-zh');
                }
            });
        }

        // æ›´æ–°å­˜å‚¨è®¡æ•°
        function updateStorageCounts() {
            const productSeries = JSON.parse(localStorage.getItem('productSeries') || '[]');
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            const backgrounds = JSON.parse(localStorage.getItem('backgroundImages') || '[]');
            const aboutUs = JSON.parse(localStorage.getItem('aboutUs') || '{}');
            
            // æ›´æ–°äº§å“ç³»åˆ—æ•°é‡æ˜¾ç¤º
            const productSeriesCount = document.getElementById('productSeriesCount');
            const productSeriesLimit = 10;
            const productSeriesRemaining = productSeriesLimit - productSeries.length;
            productSeriesCount.innerHTML = `
                <span class="current-count">${productSeries.length}</span>
                <span class="count-limit">/ ${productSeriesLimit}</span>
                <div class="remaining-info">${currentLanguage === 'en' ? 'Remaining' : 'å‰©ä½™'}: ${productSeriesRemaining}</div>
            `;
            
            // æ›´æ–°ç”»å»Šæ•°é‡æ˜¾ç¤º
            const galleryCount = document.getElementById('galleryCount');
            const galleryLimit = 15;
            const galleryRemaining = galleryLimit - gallery.length;
            galleryCount.innerHTML = `
                <span class="current-count">${gallery.length}</span>
                <span class="count-limit">/ ${galleryLimit}</span>
                <div class="remaining-info">${currentLanguage === 'en' ? 'Remaining' : 'å‰©ä½™'}: ${galleryRemaining}</div>
            `;
            
            // æ›´æ–°èƒŒæ™¯å›¾ç‰‡æ•°é‡æ˜¾ç¤º
            const backgroundCount = document.getElementById('backgroundCount');
            const backgroundLimit = 8;
            const backgroundRemaining = backgroundLimit - backgrounds.length;
            backgroundCount.innerHTML = `
                <span class="current-count">${backgrounds.length}</span>
                <span class="count-limit">/ ${backgroundLimit}</span>
                <div class="remaining-info">${currentLanguage === 'en' ? 'Remaining' : 'å‰©ä½™'}: ${backgroundRemaining}</div>
            `;
            
            // æ˜¾ç¤ºå­˜å‚¨ä½¿ç”¨æƒ…å†µ
            const storageUsage = getStorageUsage();
            const storageMB = (storageUsage / (1024 * 1024)).toFixed(2);
            
            // æŸ¥æ‰¾æˆ–åˆ›å»ºå­˜å‚¨ä½¿ç”¨æƒ…å†µæ˜¾ç¤ºå…ƒç´ 
            let storageInfoElement = document.getElementById('storageInfo');
            if (!storageInfoElement) {
                storageInfoElement = document.createElement('div');
                storageInfoElement.id = 'storageInfo';
                storageInfoElement.style.cssText = 'margin-top: 10px; padding: 8px; background: #f8f9fa; border-radius: 4px; font-size: 12px; color: #6c757d;';
                
                // æ’å…¥åˆ°å­˜å‚¨ç»Ÿè®¡åŒºåŸŸ
                const statsContainer = document.querySelector('.stats-container') || document.querySelector('.content-header');
                if (statsContainer) {
                    statsContainer.appendChild(storageInfoElement);
                }
            }
            
            // è®¡ç®—å…³äºæˆ‘ä»¬å›¾ç‰‡çš„å­˜å‚¨ä½¿ç”¨
            let aboutUsImageSize = 0;
            if (aboutUs.image) {
                aboutUsImageSize = aboutUs.image.length;
            }
            const aboutUsImageMB = (aboutUsImageSize / (1024 * 1024)).toFixed(2);
            
            storageInfoElement.innerHTML = `
                <strong>${currentLanguage === 'en' ? 'Storage Usage' : 'å­˜å‚¨ä½¿ç”¨'}:</strong> ${storageMB} MB
                ${aboutUs.image ? `<br><small>${currentLanguage === 'en' ? 'About Us Image' : 'å…³äºæˆ‘ä»¬å›¾ç‰‡'}: ${aboutUsImageMB} MB</small>` : ''}
                <button onclick="cleanupStorage()" style="margin-left: 10px; padding: 2px 8px; font-size: 11px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">
                    ${currentLanguage === 'en' ? 'Cleanup' : 'æ¸…ç†'}
                </button>
            `;
            
            // å¦‚æœå­˜å‚¨ä½¿ç”¨è¶…è¿‡4MBï¼Œæ˜¾ç¤ºè­¦å‘Š
            if (storageUsage > 4 * 1024 * 1024) {
                storageInfoElement.style.background = '#fff3cd';
                storageInfoElement.style.color = '#856404';
                storageInfoElement.style.border = '1px solid #ffeaa7';
            }
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                    if (modal.id !== 'aboutUsModal') {
                        editIndex = null;
                    }
                }
            });
        }

        // æ˜¾ç¤ºå­˜å‚¨ç®¡ç†ä¿¡æ¯
        function showStorageManagement() {
            const backgrounds = JSON.parse(localStorage.getItem('backgroundImages') || '[]');
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            const productSeries = JSON.parse(localStorage.getItem('productSeries') || '[]');
            const aboutUs = JSON.parse(localStorage.getItem('aboutUs') || '{}');
            
            const storageUsage = getStorageUsage();
            const storageMB = (storageUsage / (1024 * 1024)).toFixed(2);
            
            let message = `${currentLanguage === 'en' ? 'Storage Management' : 'å­˜å‚¨ç®¡ç†'}\n\n`;
            message += `${currentLanguage === 'en' ? 'Current Usage' : 'å½“å‰ä½¿ç”¨'}: ${storageMB} MB\n\n`;
            message += `${currentLanguage === 'en' ? 'Background Images' : 'èƒŒæ™¯å›¾ç‰‡'}: ${backgrounds.length}/8\n`;
            message += `${currentLanguage === 'en' ? 'Gallery Items' : 'ç”»å»Šé¡¹ç›®'}: ${gallery.length}/15\n`;
            message += `${currentLanguage === 'en' ? 'Product Series' : 'äº§å“ç³»åˆ—'}: ${productSeries.length}/10\n`;
            message += `${currentLanguage === 'en' ? 'About Us Image' : 'å…³äºæˆ‘ä»¬å›¾ç‰‡'}: ${aboutUs.image ? '1/1' : '0/1'}\n\n`;
            
            if (storageUsage > 4 * 1024 * 1024) {
                message += `${currentLanguage === 'en' ? 'âš ï¸ Storage usage is high. Consider deleting some items.' : 'âš ï¸ å­˜å‚¨ä½¿ç”¨é‡è¾ƒé«˜ã€‚å»ºè®®åˆ é™¤ä¸€äº›é¡¹ç›®ã€‚'}\n\n`;
            }
            
            message += `${currentLanguage === 'en' ? 'Actions:' : 'æ“ä½œï¼š'}\n`;
            message += `â€¢ ${currentLanguage === 'en' ? 'Click "Cleanup" to automatically remove old items' : 'ç‚¹å‡»"æ¸…ç†"è‡ªåŠ¨åˆ é™¤æ—§é¡¹ç›®'}\n`;
            message += `â€¢ ${currentLanguage === 'en' ? 'Delete individual items manually' : 'æ‰‹åŠ¨åˆ é™¤å•ä¸ªé¡¹ç›®'}\n`;
            message += `â€¢ ${currentLanguage === 'en' ? 'Use smaller image files' : 'ä½¿ç”¨è¾ƒå°çš„å›¾ç‰‡æ–‡ä»¶'}`;
            
            alert(message);
        }

        // è·å–è¯¦ç»†å­˜å‚¨åˆ†æ
        function getDetailedStorageAnalysis() {
            const backgrounds = JSON.parse(localStorage.getItem('backgroundImages') || '[]');
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            const productSeries = JSON.parse(localStorage.getItem('productSeries') || '[]');
            const aboutUs = JSON.parse(localStorage.getItem('aboutUs') || '{}');
            
            let analysis = `${currentLanguage === 'en' ? 'Detailed Storage Analysis' : 'è¯¦ç»†å­˜å‚¨åˆ†æ'}\n\n`;
            
            // åˆ†æèƒŒæ™¯å›¾ç‰‡
            if (backgrounds.length > 0) {
                const bgSize = backgrounds.reduce((total, item) => total + (item.image ? item.image.length : 0), 0);
                const bgMB = (bgSize / (1024 * 1024)).toFixed(2);
                analysis += `${currentLanguage === 'en' ? 'Background Images' : 'èƒŒæ™¯å›¾ç‰‡'}: ${bgMB} MB (${backgrounds.length} items)\n`;
            }
            
            // åˆ†æç”»å»Šé¡¹ç›®
            if (gallery.length > 0) {
                const gallerySize = gallery.reduce((total, item) => total + (item.image ? item.image.length : 0), 0);
                const galleryMB = (gallerySize / (1024 * 1024)).toFixed(2);
                analysis += `${currentLanguage === 'en' ? 'Gallery Items' : 'ç”»å»Šé¡¹ç›®'}: ${galleryMB} MB (${gallery.length} items)\n`;
            }
            
            // åˆ†æäº§å“ç³»åˆ—
            if (productSeries.length > 0) {
                const seriesSize = productSeries.reduce((total, item) => total + (item.image ? item.image.length : 0), 0);
                const seriesMB = (seriesSize / (1024 * 1024)).toFixed(2);
                analysis += `${currentLanguage === 'en' ? 'Product Series' : 'äº§å“ç³»åˆ—'}: ${seriesMB} MB (${productSeries.length} items)\n`;
            }
            
            // åˆ†æå…³äºæˆ‘ä»¬å›¾ç‰‡
            if (aboutUs.image) {
                const aboutSize = aboutUs.image.length;
                const aboutMB = (aboutSize / (1024 * 1024)).toFixed(2);
                analysis += `${currentLanguage === 'en' ? 'About Us Image' : 'å…³äºæˆ‘ä»¬å›¾ç‰‡'}: ${aboutMB} MB (1 item)\n`;
            } else {
                analysis += `${currentLanguage === 'en' ? 'About Us Image' : 'å…³äºæˆ‘ä»¬å›¾ç‰‡'}: 0 MB (0 items)\n`;
            }
            
            const totalUsage = getStorageUsage();
            const totalMB = (totalUsage / (1024 * 1024)).toFixed(2);
            analysis += `\n${currentLanguage === 'en' ? 'Total Usage' : 'æ€»ä½¿ç”¨é‡'}: ${totalMB} MB`;
            
            return analysis;
        }

        // å›¾ç‰‡ä¼˜åŒ–å»ºè®®
        function showImageOptimizationTips() {
            const tips = currentLanguage === 'en' ? [
                'ğŸ“± Use images with resolution 1200x800 or smaller',
                'ğŸ’¾ Convert images to JPEG format for better compression',
                'ğŸ¯ Aim for file sizes under 2MB before upload',
                'ğŸ”„ The system will automatically compress images further',
                'ğŸ—‘ï¸ Delete old/unused images to free up space',
                'ğŸ“Š Monitor storage usage with the Storage Info button'
            ] : [
                'ğŸ“± ä½¿ç”¨1200x800æˆ–æ›´å°çš„åˆ†è¾¨ç‡å›¾ç‰‡',
                'ğŸ’¾ å°†å›¾ç‰‡è½¬æ¢ä¸ºJPEGæ ¼å¼ä»¥è·å¾—æ›´å¥½çš„å‹ç¼©æ•ˆæœ',
                'ğŸ¯ ä¸Šä¼ å‰å›¾ç‰‡æ–‡ä»¶å¤§å°æ§åˆ¶åœ¨2MBä»¥ä¸‹',
                'ğŸ”„ ç³»ç»Ÿä¼šè‡ªåŠ¨è¿›ä¸€æ­¥å‹ç¼©å›¾ç‰‡',
                'ğŸ—‘ï¸ åˆ é™¤æ—§/æœªä½¿ç”¨çš„å›¾ç‰‡ä»¥é‡Šæ”¾ç©ºé—´',
                'ğŸ“Š ä½¿ç”¨å­˜å‚¨ä¿¡æ¯æŒ‰é’®ç›‘æ§å­˜å‚¨ä½¿ç”¨æƒ…å†µ'
            ];
            
            const message = `${currentLanguage === 'en' ? 'Image Optimization Tips' : 'å›¾ç‰‡ä¼˜åŒ–å»ºè®®'}\n\n${tips.join('\n')}`;
            alert(message);
        }

        // æ›´æ–°æ–‡ä»¶åæ˜¾ç¤º
        function updateFileName(input, infoElementId) {
            const file = input.files[0];
            const infoElement = document.getElementById(infoElementId);
            const uploadText = input.parentElement.querySelector('.file-upload-text');
            
            if (file) {
                // æ˜¾ç¤ºæ–‡ä»¶åå’Œå¤§å°
                const fileSize = (file.size / (1024 * 1024)).toFixed(2);
                const fileName = file.name.length > 30 ? file.name.substring(0, 30) + '...' : file.name;
                
                infoElement.innerHTML = `
                    <strong>${currentLanguage === 'en' ? 'Selected file' : 'å·²é€‰æ‹©æ–‡ä»¶'}:</strong> ${fileName}<br>
                    <strong>${currentLanguage === 'en' ? 'Size' : 'å¤§å°'}:</strong> ${fileSize} MB
                `;
                infoElement.style.display = 'block';
                
                // æ›´æ–°ä¸Šä¼ æ–‡æœ¬æ ·å¼
                uploadText.textContent = currentLanguage === 'en' ? 'File selected' : 'æ–‡ä»¶å·²é€‰æ‹©';
                uploadText.classList.add('file-selected');
            } else {
                // éšè—æ–‡ä»¶ä¿¡æ¯ï¼Œæ¢å¤é»˜è®¤æ–‡æœ¬
                infoElement.style.display = 'none';
                uploadText.textContent = currentLanguage === 'en' ? 'Click to select image' : 'ç‚¹å‡»é€‰æ‹©å›¾ç‰‡';
                uploadText.classList.remove('file-selected');
            }
        }
        
        // æ£€æŸ¥å¹¶æ¸…ç†å­˜å‚¨ç©ºé—´
        function checkAndCleanupStorage() {
            const storageUsage = getStorageUsage();
            const storageMB = (storageUsage / (1024 * 1024)).toFixed(2);
            
            // å¦‚æœå­˜å‚¨ä½¿ç”¨è¶…è¿‡5MBï¼Œè‡ªåŠ¨æ¸…ç†
            if (storageUsage > 5 * 1024 * 1024) {
                console.log(`å­˜å‚¨ä½¿ç”¨é‡è¾ƒé«˜: ${storageMB} MBï¼Œå¼€å§‹è‡ªåŠ¨æ¸…ç†...`);
                
                if (cleanupStorage()) {
                    const newUsage = getStorageUsage();
                    const newMB = (newUsage / (1024 * 1024)).toFixed(2);
                    console.log(`è‡ªåŠ¨æ¸…ç†å®Œæˆï¼Œå½“å‰ä½¿ç”¨é‡: ${newMB} MB`);
                    
                    // æ˜¾ç¤ºæ¸…ç†ç»“æœ
                    setTimeout(() => {
                        if (currentLanguage === 'en') {
                            alert(`Storage automatically cleaned up!\nBefore: ${storageMB} MB\nAfter: ${newMB} MB\n\nOld items have been removed to free up space.`);
                        } else {
                            alert(`å­˜å‚¨å·²è‡ªåŠ¨æ¸…ç†ï¼\næ¸…ç†å‰: ${storageMB} MB\næ¸…ç†å: ${newMB} MB\n\næ—§é¡¹ç›®å·²è¢«åˆ é™¤ä»¥é‡Šæ”¾ç©ºé—´ã€‚`);
                        }
                    }, 1000);
                }
            }
        }

        // é”®ç›˜äº‹ä»¶
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                        if (modal.id !== 'aboutUsModal') {
                            editIndex = null;
                        }
                    }
                });
            }
        });

        // é€€å‡ºç™»å½•å‡½æ•°
        function logout() {
            console.log('é€€å‡ºç™»å½•...');
            
            // æ¸…é™¤å½“å‰ç”¨æˆ·ä¿¡æ¯
            localStorage.removeItem('currentUser');
            localStorage.removeItem('contentManagerLoggedIn');
            
            // è·³è½¬å›ç™»å½•é¡µé¢
            window.location.href = 'content-login.html';
        }

        // æ¸…ç©ºæ‰€æœ‰å­˜å‚¨
        function clearAllStorage() {
            if (confirm(currentLanguage === 'en' ? 'Are you sure you want to clear all content? This action cannot be undone.' : 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚')) {
                localStorage.removeItem('productSeries');
                localStorage.removeItem('gallery');
                localStorage.removeItem('backgroundImages');
                localStorage.removeItem('aboutUs');
                
                // é‡æ–°åŠ è½½é¡µé¢
                location.reload();
            }
        }

        // ä¼˜åŒ–å­˜å‚¨
        function optimizeStorage() {
            console.log('å¼€å§‹ä¼˜åŒ–å­˜å‚¨...');
            
            if (cleanupStorage()) {
                const newUsage = getStorageUsage();
                const newMB = (newUsage / (1024 * 1024)).toFixed(2);
                
                if (currentLanguage === 'en') {
                    alert(`Storage optimized successfully!\nCurrent usage: ${newMB} MB`);
                } else {
                    alert(`å­˜å‚¨ä¼˜åŒ–æˆåŠŸï¼\nå½“å‰ä½¿ç”¨é‡: ${newMB} MB`);
                }
                
                // æ›´æ–°æ˜¾ç¤º
                updateStorageCounts();
            } else {
                if (currentLanguage === 'en') {
                    alert('Storage optimization failed. Please try again.');
                } else {
                    alert('å­˜å‚¨ä¼˜åŒ–å¤±è´¥ã€‚è¯·é‡è¯•ã€‚');
                }
            }
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
                window.location.href = 'content-login.html';
                return;
            }
            
            try {
                const userInfo = JSON.parse(currentUser);
                if (userInfo.userType !== 'content') {
                    // ä¸æ˜¯å†…å®¹ç®¡ç†å‘˜ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
                    window.location.href = 'content-login.html';
                    return;
                }
            } catch (e) {
                // ç”¨æˆ·ä¿¡æ¯æ— æ•ˆï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
                localStorage.removeItem('currentUser');
                window.location.href = 'content-login.html';
                return;
            }
        }

        console.log('å†…å®¹ç®¡ç†é¡µé¢è„šæœ¬å·²åŠ è½½');
    </script>
</body>
</html>
